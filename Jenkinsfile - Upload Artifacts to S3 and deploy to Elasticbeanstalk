

pipeline {
    agent any

   stages {

      
     stage('QA BUILD') {
      steps {
        echo 'Deploying from DEV TO QA'
              }
        } 
        
     stage('Upload S3') {
      steps {
        echo 'Uploading'
        sh 'aws s3 cp /var/lib/jenkins/workspace/myapp/Dockerrun.aws.json s3://s3-elasticbeanstalk2/${PROJECT_NAME}-${GIT_BRANCH}-${BUILD_NUMBER}.zip --acl public-read-write --region us-east-1'
            }
        }   
      stage('Deploy') {
       steps {
         echo 'Deploying'
          sh 'aws elasticbeanstalk create-application-version --region us-east-1 --application-name  testapp2 --version-label ${PROJECT_NAME}-${BUILD_NUMBER} --source-bundle S3Bucket="s3-elasticbeanstalk2",S3Key="${PROJECT_NAME}-${GIT_BRANCH}-${BUILD_NUMBER}.zip"' 
          sh 'aws elasticbeanstalk update-environment --region us-east-1 --environment-name testapp2-env --version-label ${PROJECT_NAME}-${BUILD_NUMBER}'
            }
        }    
}
     post {
      success {
        echo " Status: PIPELINE ${currentBuild.result} | Job: ${env.JOB_NAME} | Build number ${env.BUILD_NUMBER}"
            }
      failure {
        echo " Status: PIPELINE ${currentBuild.result} | Job: ${env.JOB_NAME} | Build number ${env.BUILD_NUMBER}"
             }
      aborted {
        echo " Status: PIPELINE ${currentBuild.result} | Job: ${env.JOB_NAME} | Build number ${env.BUILD_NUMBER}"
            }
         }
}