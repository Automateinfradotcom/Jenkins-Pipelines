pipeline {
agent none 
stages {
  stage('build and test') { 
  agent {
    node{ 
    label "Jenkins"
    }
   }
  steps {
   sh 'mv clean package'
   sh 'echo "build run"'
   archiveArtifacts artifacts: 'gameoflife-web/target/gameoflife.war', fingerprint:true
   junit '**/target/surefire-reports/*.xml' 
        }
   }
   stage('Sonar Analysis') {
   agent  {
     node {
      label "Jenkins"
        }
    }
   steps {
    sh 'echo "running sonar analysis"'
    sh "mvn sonar:sonar -Dsonar.host.url=http://sonarqube:9000 -Dsonar.branch=${env.BRANCH_NAME}"
    }
    }
